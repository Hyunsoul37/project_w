(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[514],{6278:function(e,n,t){"use strict";t.d(n,{Z:function(){return k},c:function(){return j}});var r=t(7568),o=t(1799),i=t(9396),m=t(828),a=t(6305),c=t(655),s=t(5893),u=t(1163),l=t(7294),d=t(9473),f=t(72),p=t(2379),h=t.n(p),C=function(e){var n=e.isMainInput,t=e.subCommentuser,r=e.reviewId,o=e.AddfirstComment,i=e.AddSecondComment,a=(0,d.v9)(function(e){return e.user}),c=(0,l.useRef)(null),p=(0,u.useRouter)(),C=(0,m.Z)((0,l.useState)(!1),2),I=C[0],_=C[1],v=(0,m.Z)((0,l.useState)(""),2),g=v[0],x=v[1];return(0,s.jsxs)("div",{className:n?h().CommentInput:h().CommentInput_sub,children:[(0,s.jsx)("img",{src:a.isLoggedIn&&null!==a.userData&&""!==a.userData.data.memberInfo.profileImg&&void 0!==a.userData.data.memberInfo.profileImg?a.userData.data.memberInfo.profileImg:j}),(0,s.jsxs)("div",{className:h().CommentInput_Input,children:[n?(0,s.jsx)("input",{type:"text",placeholder:"칭찬과 격려의 댓글은 작성자에게 큰 힘이 됩니다 : )",value:g,onChange:function(e){return x(e.target.value)}}):(0,s.jsxs)("div",{className:h().CommentInput_subInput,children:[(0,s.jsx)("span",{children:t?"@".concat(t):" "}),(0,s.jsx)("input",{type:"text",value:g,autoFocus:!0,onChange:function(e){return x(e.target.value)}})]}),(0,s.jsx)("button",{onClick:function(){if(!0===a.isLoggedIn)n?(o({reviewId:r,commentId:0,writerId:a.userData.data.memberInfo.pid,writerNick:a.userData.data.memberInfo.nickName?a.userData.data.memberInfo.nickName:"임시",comment:g,writerProfile:void 0===a.userData.data.memberInfo.profileImg?"null":a.userData.data.memberInfo.profileImg,regiDate:(0,f._3)(),like:!1,child:[]}),x("")):(i(g,0,t),x(""));else{var e;null===(e=c.current)||void 0===e||e.showModal(),_(!0)}},children:"입력"})]}),(0,s.jsxs)("dialog",{style:I?{display:"flex"}:{display:"none"},className:h().modal,ref:c,children:[(0,s.jsx)("p",{children:"로그인이 필요한 기능입니다."}),(0,s.jsx)("button",{onClick:function(){var e;null===(e=c.current)||void 0===e||e.close(),_(!1),p.push({pathname:"/login",query:{returnUrl:p.asPath}},"/login")},children:"확인"})]})]})},I=t(4976),_=t.n(I),v=function(e){var n,t,r,o,i=(0,d.v9)(function(e){return e.user}),a=(0,l.useRef)(null),c=(0,u.useRouter)(),p=(0,m.Z)((0,l.useState)(!1),2),h=p[0],I=p[1],v=(0,m.Z)((0,l.useState)(""),2),g=v[0],x=v[1],b=(0,m.Z)((0,l.useState)(-1),2),w=b[0],k=b[1],Z=(0,m.Z)((0,l.useState)(-10),2),S=Z[0],N=Z[1],L=(0,m.Z)((0,l.useState)(-10),2),y=L[0],D=L[1],M=function(n){N(n),D(-10),e.ChangeSubComment(-1),e.ChangeComment(n)},A=function(n,t){D(t),N(-10),e.ChangeSubComment(t),e.ChangeComment(-1),x(n)},W=function(n,t,r){e.AddSecondComment(e.commentId,{reviewId:e.reviewId,parentId:e.commentId,commentId:t,writerId:i.userData.data.memberInfo.pid,writerNick:i.userData.data.memberInfo.nickName,comment:n,writerProfile:void 0===i.userData.data.memberInfo.profileImg?"null":i.userData.data.memberInfo.profileImg,regiDate:(0,f._3)(),like:!1,tagWriterNick:r,tagWriterId:w}),N(-10),D(-10),e.ChangeComment(-1),e.ChangeSubComment(-1)};return(0,s.jsxs)("div",{className:_().CommentList,children:[(0,s.jsxs)("div",{className:_().firstComment,children:[(0,s.jsxs)("div",{className:_().firstComment_Info,children:[(0,s.jsx)("img",{src:null!==e.writerProfile?e.writerProfile:j}),(0,s.jsx)("div",{children:e.writerNick})]}),(0,s.jsxs)("div",{className:_().commentText,children:[(0,s.jsx)("p",{children:e.comment}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{children:e.regiDate.split("T")[0]}),(0,s.jsx)("span",{className:e.like?_().like:"",onClick:(n=e.commentId,function(){if(!0===i.isLoggedIn)e.firstCommentLikeHandler(n);else{var t;null===(t=a.current)||void 0===t||t.showModal(),I(!0)}}),children:"♥ 좋아요"}),(0,s.jsx)("span",{onClick:(t=e.commentId,r=e.writerId,function(){if(-1!==e.curCommentnumber||-1!==e.cursubCommentnumber)window.confirm("작성중인 댓글이 있습니다. 댓글 전환 하시겠습니까?")&&(M(t),k(r));else if(!0===i.isLoggedIn)M(t),k(r);else{var n;null===(n=a.current)||void 0===n||n.showModal(),I(!0)}}),children:"답글달기"})]})]}),e.curCommentnumber===S&&(0,s.jsx)(C,{isMainInput:!1,reviewId:e.reviewId,subCommentuser:e.writerNick,AddSecondComment:W})]}),(null===(o=e.child)||void 0===o?void 0:o.length)>0&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:_().SecondCommentWrapper,children:e.child.map(function(n){var t,r,o,m;return(0,s.jsxs)("div",{className:_().SecondComment,children:[(0,s.jsxs)("div",{className:_().SecondComment_Info,children:[(0,s.jsx)("img",{src:null!==n.writerProfile?n.writerProfile:j}),(0,s.jsx)("div",{children:n.writerNick})]}),(0,s.jsxs)("div",{className:_().SecondComment_commentText,children:[(0,s.jsxs)("div",{className:_().SecondComment_contents,children:[(0,s.jsxs)("p",{children:["@",n.tagWriterNick]}),(0,s.jsx)("p",{children:n.comment})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{children:n.regiDate.split("T")[0]}),(0,s.jsx)("span",{className:n.like?_().like:"",onClick:(t=n.commentId,function(){if(!0===i.isLoggedIn)e.SecondCommentLikeHandler(t);else{var n;null===(n=a.current)||void 0===n||n.showModal(),I(!0)}}),children:"♥ 좋아요"}),(0,s.jsx)("span",{onClick:(r=n.writerNick,o=n.commentId,m=n.writerId,function(){if(-1!==e.curCommentnumber||-1!==e.cursubCommentnumber)window.confirm("작성중인 댓글이 있습니다. 댓글 전환 하시겠습니까?")&&(A(r,o),k(m));else if(!0===i.isLoggedIn)A(r,o),k(m);else{var n;null===(n=a.current)||void 0===n||n.showModal(),I(!0)}}),children:"답글달기"})]})]})]})})}),e.cursubCommentnumber===y&&(0,s.jsx)(C,{isMainInput:!1,subCommentuser:g,reviewId:e.reviewId,AddSecondComment:W})]}),(0,s.jsxs)("dialog",{style:h?{display:"flex"}:{display:"none"},className:_().modal,ref:a,children:[(0,s.jsx)("p",{children:"로그인이 필요한 기능입니다."}),(0,s.jsx)("button",{onClick:function(){var e;null===(e=a.current)||void 0===e||e.close(),I(!1),c.push({pathname:"/login",query:{returnUrl:c.asPath}},"/login")},children:"확인"})]})]})},g=t(4442),x=t.n(g),b=t(6154),w=t(8650),j="/images/default_profile.png",k=function(e){var n,t,u,f,p,h,I,_,g=e.reviewId,j=(0,m.Z)((0,l.useState)(),2),k=j[0],Z=j[1],S=(0,m.Z)((0,l.useState)(-1),2),N=S[0],L=S[1],y=(0,m.Z)((0,l.useState)(-1),2),D=y[0],M=y[1];(0,d.v9)(function(e){return e.user}),(0,l.useEffect)(function(){A()},[]);var A=(0,l.useCallback)((0,r.Z)(function(){var e;return(0,c.__generator)(this,function(n){switch(n.label){case 0:if(!localStorage.getItem("refresh"))return[3,3];return[4,P().then(function(e){return e})];case 1:return e=n.sent(),[4,b.Z.get("/api/comment?reviewId=".concat(g),{headers:{Authorization:"bearer ".concat(e)}}).then(function(e){Z({parent:e.data.data.map(function(e){return e.child?e:(0,i.Z)((0,o.Z)({},e),{child:[]})})})}).catch(function(e){return console.log(e)})];case 2:return n.sent(),[3,5];case 3:return[4,b.Z.get("/api/comment?reviewId=".concat(g)).then(function(e){Z({parent:e.data.data.map(function(e){return e.child?e:(0,i.Z)((0,o.Z)({},e),{child:[]})})})}).catch(function(e){return console.log(e)})];case 4:n.sent(),n.label=5;case 5:return[2]}})}),[g]),W=function(e){L(e)},T=function(e){M(e)},P=(n=(0,r.Z)(function(){var e,n,t,r,o;return(0,c.__generator)(this,function(i){switch(i.label){case 0:if(e=(0,w.ej)("token"),n="",!e)return[3,1];return n=e,[3,3];case 1:return t=localStorage.getItem("refresh"),r=localStorage.getItem("id"),(o=new Date).setMinutes(o.getMinutes()+1),[4,b.Z.post("/api/auth/refresh",{pid:r,refreshToken:t}).then(function(e){(0,w.d8)("token",e.data.data.reissueToken,{expires:o}),n=e.data.data.reissueToken}).catch(function(e){return console.log(e)})];case 2:i.sent(),i.label=3;case 3:return[2,n]}})}),function(){return n.apply(this,arguments)}),z=(t=(0,r.Z)(function(e){var n;return(0,c.__generator)(this,function(t){switch(t.label){case 0:return[4,P().then(function(e){return e})];case 1:return n=t.sent(),[4,b.Z.post("/api/comment",{reviewId:e.reviewId,comment:e.comment},{headers:{Authorization:"bearer ".concat(n)}}).then(function(n){var t=n.data.data,r=(0,o.Z)({},k);r.parent.push((0,i.Z)((0,o.Z)({},e),{commentId:t})),Z(r)}).catch(function(e){return console.log(e)})];case 2:return t.sent(),[2]}})}),function(e){return t.apply(this,arguments)}),E=(u=(0,r.Z)(function(e,n){var t;return(0,c.__generator)(this,function(r){switch(r.label){case 0:return[4,P().then(function(e){return e})];case 1:return t=r.sent(),[4,b.Z.post("/api/comment",{reviewId:n.reviewId,comment:n.comment,parentId:n.parentId,tagWriterId:n.tagWriterId},{headers:{Authorization:"bearer ".concat(t)}}).then(function(){var t,r=(0,o.Z)({},k);null==r||null===(t=r.parent)||void 0===t||t.map(function(t){t.commentId===e&&(0,i.Z)((0,o.Z)({},t),{child:t.child.push(n)})}),Z(r)}).catch(function(e){return console.log(e)})];case 2:return r.sent(),[2]}})}),function(e,n){return u.apply(this,arguments)}),H=(f=(0,r.Z)(function(e){var n;return(0,c.__generator)(this,function(t){switch(t.label){case 0:return[4,P().then(function(e){return e})];case 1:return n=t.sent(),[4,b.Z.post("/api/comment/like",{commentId:e},{headers:{Authorization:"bearer ".concat(n)}}).then(function(){var n=null==k?void 0:k.parent.map(function(n){return n.commentId===e?(0,i.Z)((0,o.Z)({},n),{like:!n.like}):n});n&&Z({parent:n})}).catch(function(e){return console.log(e)})];case 2:return t.sent(),[2]}})}),function(e){return f.apply(this,arguments)}),J=(p=(0,r.Z)(function(e){var n;return(0,c.__generator)(this,function(t){switch(t.label){case 0:return[4,P().then(function(e){return e})];case 1:return n=t.sent(),[4,b.Z.post("/api/comment/like",{commentId:e},{headers:{Authorization:"bearer ".concat(n)}}).then(function(){var n=(0,o.Z)({},null==k?void 0:k.parent[0]);null==k||k.parent.map(function(t){return t.child.map(function(r){r.commentId===e&&(r.like=!r.like,n=(0,i.Z)((0,o.Z)({},t),{child:(0,a.Z)(t.child)}))})});var t=null==k?void 0:k.parent.map(function(e){return e.commentId===n.commentId?(0,o.Z)({},n):e});t&&Z({parent:t})}).catch(function(e){return console.log(e)})];case 2:return t.sent(),[2]}})}),function(e){return p.apply(this,arguments)});return(0,s.jsxs)("div",{className:x().CommunityComment,children:[(0,s.jsx)("div",{className:x().InputWrapper,children:(0,s.jsx)(C,{isMainInput:!0,reviewId:null!==(_=null===(h=null==k?void 0:k.parent[0])||void 0===h?void 0:h.reviewId)&&void 0!==_?_:g,AddfirstComment:z})}),(0,s.jsx)("div",{className:x().CommentList,children:null==k?void 0:null===(I=k.parent)||void 0===I?void 0:I.map(function(e,n){return(0,s.jsx)(v,(0,o.Z)({curCommentnumber:N,cursubCommentnumber:D,ChangeSubComment:T,ChangeComment:W,AddSecondComment:E,firstCommentLikeHandler:H,SecondCommentLikeHandler:J},e),"review_".concat(n))})})]})}},72:function(e,n,t){"use strict";t.d(n,{_3:function(){return o},qJ:function(){return r}});var r=function(e,n,t){var r=0,o=[],i=Math.round(e);for(r=0;r<i;r++)o.push(n);for(r=0;r<5-i;r++)o.push(t);return o},o=function(){var e=new Date().getFullYear(),n=new Date().getMonth()+1,t=new Date().getDate();return n<10&&(n="0".concat(n)),t<10&&(t="0".concat(t)),"".concat(e,".").concat(n,".").concat(t)}},8606:function(e,n,t){"use strict";var r=t(5893),o=t(9008),i=t.n(o);n.Z=function(e){var n=e.title;return(0,r.jsx)(i(),{children:(0,r.jsxs)("title",{children:["WAGU | ",n]})})}},2379:function(e){e.exports={CommentInput:"CommentInput_CommentInput__bosiT",CommentInput_sub:"CommentInput_CommentInput_sub__uSa3Z",CommentInput_Input:"CommentInput_CommentInput_Input__rQaUr",CommentInput_subInput:"CommentInput_CommentInput_subInput__S0BVQ",like:"CommentInput_like__ZAON1",modal:"CommentInput_modal__9e1JX"}},4976:function(e){e.exports={CommentList:"CommentList_CommentList__nzmv_",modal:"CommentList_modal__Qw_Zj",firstComment:"CommentList_firstComment__TacWJ",firstComment_Info:"CommentList_firstComment_Info__f5Kbn",commentText:"CommentList_commentText__tfEda",SecondCommentWrapper:"CommentList_SecondCommentWrapper__LjKt9",SecondComment:"CommentList_SecondComment__xqC5K",SecondComment_Info:"CommentList_SecondComment_Info__W265J",SecondComment_commentText:"CommentList_SecondComment_commentText__H3mKE",SecondComment_contents:"CommentList_SecondComment_contents__zyRJk",like:"CommentList_like__N1925"}},4442:function(e){e.exports={CommunityComment:"CommunityComment_CommunityComment__X06pa",InputWrapper:"CommunityComment_InputWrapper__gUpNM",CommentList:"CommunityComment_CommentList__XXMgs"}},9008:function(e,n,t){e.exports=t(3121)}}]);