(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[514],{6278:function(e,n,t){"use strict";t.d(n,{Z:function(){return k},c:function(){return j}});var r=t(7568),o=t(1799),i=t(9396),m=t(828),a=t(6305),s=t(655),c=t(5893),u=t(1163),l=t(7294),d=t(9473),f=t(72),p=t(2379),C=t.n(p),h=function(e){var n=e.isMainInput,t=e.subCommentuser,r=e.reviewId,o=e.AddfirstComment,i=e.AddSecondComment,a=(0,d.v9)(function(e){return e.user}),s=(0,l.useRef)(null),p=(0,u.useRouter)(),h=(0,m.Z)((0,l.useState)(!1),2),I=h[0],_=h[1],v=(0,m.Z)((0,l.useState)(""),2),g=v[0],x=v[1];return(0,c.jsxs)("div",{className:n?C().CommentInput:C().CommentInput_sub,children:[(0,c.jsx)("img",{src:a.isLoggedIn&&null!==a.userData&&""!==a.userData.data.memberInfo.profileImg&&void 0!==a.userData.data.memberInfo.profileImg?a.userData.data.memberInfo.profileImg:j}),(0,c.jsxs)("div",{className:C().CommentInput_Input,children:[n?(0,c.jsx)("input",{type:"text",placeholder:"칭찬과 격려의 댓글은 작성자에게 큰 힘이 됩니다 : )",value:g,onChange:function(e){return x(e.target.value)}}):(0,c.jsxs)("div",{className:C().CommentInput_subInput,children:[(0,c.jsx)("span",{children:t?"@".concat(t):" "}),(0,c.jsx)("input",{type:"text",value:g,autoFocus:!0,onChange:function(e){return x(e.target.value)}})]}),(0,c.jsx)("button",{onClick:function(){if(!0===a.isLoggedIn)n?(o({reviewId:r,commentId:0,writerId:a.userData.data.memberInfo.pid,writerNick:a.userData.data.memberInfo.nickName?a.userData.data.memberInfo.nickName:"임시",comment:g,writerProfile:void 0===a.userData.data.memberInfo.profileImg?"null":a.userData.data.memberInfo.profileImg,regiDate:(0,f._3)(),like:!1,child:[]}),x("")):(i(g,0,t),x(""));else{var e;null===(e=s.current)||void 0===e||e.showModal(),_(!0)}},children:"입력"})]}),(0,c.jsxs)("dialog",{style:I?{display:"flex"}:{display:"none"},className:C().modal,ref:s,children:[(0,c.jsx)("p",{children:"로그인이 필요한 기능입니다."}),(0,c.jsx)("button",{onClick:function(){var e;null===(e=s.current)||void 0===e||e.close(),_(!1),p.push({pathname:"/login",query:{returnUrl:p.asPath}},"/login")},children:"확인"})]})]})},I=t(4976),_=t.n(I),v=function(e){var n,t,r,o,i=(0,d.v9)(function(e){return e.user}),a=(0,l.useRef)(null),s=(0,u.useRouter)(),p=(0,m.Z)((0,l.useState)(!1),2),C=p[0],I=p[1],v=(0,m.Z)((0,l.useState)(""),2),g=v[0],x=v[1],w=(0,m.Z)((0,l.useState)(-1),2),b=w[0],k=w[1],S=(0,m.Z)((0,l.useState)(-10),2),Z=S[0],N=S[1],L=(0,m.Z)((0,l.useState)(-10),2),D=L[0],y=L[1],M=function(n){N(n),y(-10),e.ChangeSubComment(-1),e.ChangeComment(n)},W=function(n,t){y(t),N(-10),e.ChangeSubComment(t),e.ChangeComment(-1),x(n)},T=function(n,t,r){e.AddSecondComment(e.commentId,{reviewId:e.reviewId,parentId:e.commentId,commentId:t,writerId:i.userData.data.memberInfo.pid,writerNick:i.userData.data.memberInfo.nickName,comment:n,writerProfile:void 0===i.userData.data.memberInfo.profileImg?"null":i.userData.data.memberInfo.profileImg,regiDate:(0,f._3)(),like:!1,tagWriterNick:r,tagWriterId:b}),N(-10),y(-10),e.ChangeComment(-1),e.ChangeSubComment(-1)};return(0,c.jsxs)("div",{className:_().CommentList,children:[(0,c.jsxs)("div",{className:_().firstComment,children:[(0,c.jsxs)("div",{className:_().firstComment_Info,children:[(0,c.jsx)("img",{src:"null"!==e.writerProfile?e.writerProfile:j}),(0,c.jsx)("div",{children:e.writerNick})]}),(0,c.jsxs)("div",{className:_().commentText,children:[(0,c.jsx)("p",{children:e.comment}),(0,c.jsxs)("div",{children:[(0,c.jsx)("span",{children:e.regiDate.split("T")[0]}),(0,c.jsx)("span",{className:e.like?_().like:"",onClick:(n=e.commentId,function(){if(!0===i.isLoggedIn)e.firstCommentLikeHandler(n);else{var t;null===(t=a.current)||void 0===t||t.showModal(),I(!0)}}),children:"♥ 좋아요"}),(0,c.jsx)("span",{onClick:(t=e.commentId,r=e.writerId,function(){if(-1!==e.curCommentnumber||-1!==e.cursubCommentnumber)window.confirm("작성중인 댓글이 있습니다. 댓글 전환 하시겠습니까?")&&(M(t),k(r));else if(!0===i.isLoggedIn)M(t),k(r);else{var n;null===(n=a.current)||void 0===n||n.showModal(),I(!0)}}),children:"답글달기"})]})]}),e.curCommentnumber===Z&&(0,c.jsx)(h,{isMainInput:!1,reviewId:e.reviewId,subCommentuser:e.writerNick,AddSecondComment:T})]}),(null===(o=e.child)||void 0===o?void 0:o.length)>0&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{className:_().SecondCommentWrapper,children:e.child.map(function(n){var t,r,o,m;return(0,c.jsxs)("div",{className:_().SecondComment,children:[(0,c.jsxs)("div",{className:_().SecondComment_Info,children:[(0,c.jsx)("img",{src:"null"!==n.writerProfile?n.writerProfile:j}),(0,c.jsx)("div",{children:n.writerNick})]}),(0,c.jsxs)("div",{className:_().SecondComment_commentText,children:[(0,c.jsxs)("div",{className:_().SecondComment_contents,children:[(0,c.jsxs)("p",{children:["@",n.tagWriterNick]}),(0,c.jsx)("p",{children:n.comment})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("span",{children:n.regiDate.split("T")[0]}),(0,c.jsx)("span",{className:n.like?_().like:"",onClick:(t=n.commentId,function(){if(!0===i.isLoggedIn)e.SecondCommentLikeHandler(t);else{var n;null===(n=a.current)||void 0===n||n.showModal(),I(!0)}}),children:"♥ 좋아요"}),(0,c.jsx)("span",{onClick:(r=n.writerNick,o=n.commentId,m=n.writerId,function(){if(-1!==e.curCommentnumber||-1!==e.cursubCommentnumber)window.confirm("작성중인 댓글이 있습니다. 댓글 전환 하시겠습니까?")&&(W(r,o),k(m));else if(!0===i.isLoggedIn)W(r,o),k(m);else{var n;null===(n=a.current)||void 0===n||n.showModal(),I(!0)}}),children:"답글달기"})]})]})]})})}),e.cursubCommentnumber===D&&(0,c.jsx)(h,{isMainInput:!1,subCommentuser:g,reviewId:e.reviewId,AddSecondComment:T})]}),(0,c.jsxs)("dialog",{style:C?{display:"flex"}:{display:"none"},className:_().modal,ref:a,children:[(0,c.jsx)("p",{children:"로그인이 필요한 기능입니다."}),(0,c.jsx)("button",{onClick:function(){var e;null===(e=a.current)||void 0===e||e.close(),I(!1),s.push({pathname:"/login",query:{returnUrl:s.asPath}},"/login")},children:"확인"})]})]})},g=t(4442),x=t.n(g),w=t(6154),b=t(8650),j="/images/default_profile.png",k=function(e){var n,t,u,d,f,p,C=e.reviewId,I=(0,m.Z)((0,l.useState)(),2),_=I[0],g=I[1],j=(0,m.Z)((0,l.useState)(-1),2),k=j[0],S=j[1],Z=(0,m.Z)((0,l.useState)(-1),2),N=Z[0],L=Z[1];(0,l.useEffect)(function(){D()},[]);var D=(0,l.useCallback)((0,r.Z)(function(){var e;return(0,s.__generator)(this,function(n){switch(n.label){case 0:return e=[],[4,w.Z.get("/api/comment?reviewId=".concat(C)).then(function(n){e=n.data.data.map(function(e){return e.child?e:(0,i.Z)((0,o.Z)({},e),{child:[]})})}).catch(function(e){return console.log(e)})];case 1:return n.sent(),g({parent:e}),[2]}})}),[C]),y=function(e){S(e)},M=function(e){L(e)},W=(n=(0,r.Z)(function(){var e,n,t,r,o;return(0,s.__generator)(this,function(i){switch(i.label){case 0:if(e=(0,b.ej)("token"),n="",!e)return[3,1];return n=e,[3,3];case 1:return t=localStorage.getItem("refresh"),r=localStorage.getItem("id"),(o=new Date).setMinutes(o.getMinutes()+1),[4,w.Z.post("/api/auth/refresh",{pid:r,refreshToken:t}).then(function(e){(0,b.d8)("token",e.data.data.reissueToken,{expires:o}),n=e.data.data.reissueToken}).catch(function(e){return console.log(e)})];case 2:i.sent(),i.label=3;case 3:return[2,n]}})}),function(){return n.apply(this,arguments)}),T=(t=(0,r.Z)(function(e){var n;return(0,s.__generator)(this,function(t){switch(t.label){case 0:return[4,W().then(function(e){return e})];case 1:return n=t.sent(),[4,w.Z.post("/api/comment",{reviewId:e.reviewId,comment:e.comment},{headers:{Authorization:"bearer ".concat(n)}}).then(function(n){var t=n.data.data,r=(0,o.Z)({},_);r.parent.push((0,i.Z)((0,o.Z)({},e),{commentId:t})),g(r)}).catch(function(e){return console.log(e)})];case 2:return t.sent(),[2]}})}),function(e){return t.apply(this,arguments)}),A=(u=(0,r.Z)(function(e,n){var t;return(0,s.__generator)(this,function(r){switch(r.label){case 0:return[4,W().then(function(e){return e})];case 1:return t=r.sent(),[4,w.Z.post("/api/comment",{reviewId:n.reviewId,comment:n.comment,parentId:n.parentId,tagWriterId:n.tagWriterId},{headers:{Authorization:"bearer ".concat(t)}}).then(function(){var t,r=(0,o.Z)({},_);null==r||null===(t=r.parent)||void 0===t||t.map(function(t){t.commentId===e&&(0,i.Z)((0,o.Z)({},t),{child:t.child.push(n)})}),g(r)}).catch(function(e){return console.log(e)})];case 2:return r.sent(),[2]}})}),function(e,n){return u.apply(this,arguments)}),P=function(e){var n=null==_?void 0:_.parent.map(function(n){return n.commentId===e?(0,i.Z)((0,o.Z)({},n),{commentLike:!n.like}):n});n&&g({parent:n})},E=function(e){var n=(0,o.Z)({},null==_?void 0:_.parent[0]);null==_||_.parent.map(function(t){return t.child.map(function(r){r.commentId===e&&(r.like=!r.like,n=(0,i.Z)((0,o.Z)({},t),{child:(0,a.Z)(t.child)}))})});var t=null==_?void 0:_.parent.map(function(e){return e.commentId===n.commentId?(0,o.Z)({},n):e});t&&g({parent:t})};return(0,c.jsxs)("div",{className:x().CommunityComment,children:[(0,c.jsx)("div",{className:x().InputWrapper,children:(0,c.jsx)(h,{isMainInput:!0,reviewId:null!==(p=null===(d=null==_?void 0:_.parent[0])||void 0===d?void 0:d.reviewId)&&void 0!==p?p:C,AddfirstComment:T})}),(0,c.jsx)("div",{className:x().CommentList,children:null==_?void 0:null===(f=_.parent)||void 0===f?void 0:f.map(function(e,n){return(0,c.jsx)(v,(0,o.Z)({curCommentnumber:k,cursubCommentnumber:N,ChangeSubComment:M,ChangeComment:y,AddSecondComment:A,firstCommentLikeHandler:P,SecondCommentLikeHandler:E},e),"review_".concat(n))})})]})}},72:function(e,n,t){"use strict";t.d(n,{_3:function(){return o},qJ:function(){return r}});var r=function(e,n,t){var r=0,o=[],i=Math.round(e);for(r=0;r<i;r++)o.push(n);for(r=0;r<5-i;r++)o.push(t);return o},o=function(){var e=new Date().getFullYear(),n=new Date().getMonth()+1,t=new Date().getDate();return n<10&&(n="0".concat(n)),t<10&&(t="0".concat(t)),"".concat(e,".").concat(n,".").concat(t)}},8606:function(e,n,t){"use strict";var r=t(5893),o=t(9008),i=t.n(o);n.Z=function(e){var n=e.title;return(0,r.jsx)(i(),{children:(0,r.jsxs)("title",{children:["WAGU | ",n]})})}},2379:function(e){e.exports={CommentInput:"CommentInput_CommentInput__bosiT",CommentInput_sub:"CommentInput_CommentInput_sub__uSa3Z",CommentInput_Input:"CommentInput_CommentInput_Input__rQaUr",CommentInput_subInput:"CommentInput_CommentInput_subInput__S0BVQ",like:"CommentInput_like__ZAON1",modal:"CommentInput_modal__9e1JX"}},4976:function(e){e.exports={CommentList:"CommentList_CommentList__nzmv_",modal:"CommentList_modal__Qw_Zj",firstComment:"CommentList_firstComment__TacWJ",firstComment_Info:"CommentList_firstComment_Info__f5Kbn",commentText:"CommentList_commentText__tfEda",SecondCommentWrapper:"CommentList_SecondCommentWrapper__LjKt9",SecondComment:"CommentList_SecondComment__xqC5K",SecondComment_Info:"CommentList_SecondComment_Info__W265J",SecondComment_commentText:"CommentList_SecondComment_commentText__H3mKE",SecondComment_contents:"CommentList_SecondComment_contents__zyRJk",like:"CommentList_like__N1925"}},4442:function(e){e.exports={CommunityComment:"CommunityComment_CommunityComment__X06pa",InputWrapper:"CommunityComment_InputWrapper__gUpNM",CommentList:"CommunityComment_CommentList__XXMgs"}},9008:function(e,n,t){e.exports=t(3121)}}]);